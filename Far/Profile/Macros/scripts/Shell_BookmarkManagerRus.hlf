.Language=Russian,Russian (Русский)
.PluginContents=Менеджер закладок
.Options CtrlStartPosChar=|

@main
$^Главное окно

^#Описание#

   Менеджер закладок позволяет назначать закладки на папки и файлы, а также переходить по ним, а также по существующим путям из переменных окружения.
Кроме того, для элемента назначения можно выполнить два действия из контекстного меню системы: открыть и отредактировать.
Для этого можно также использовать ~быстрые клавиши~@keys@ и ~префиксы~@prefix@. Скрипт может вызываться из меню плагинов или дисков Far.
Для меню дисков скрываются те объекты в закладке, которые не подходят (например, папки для правой панели в меню дисков левой панели).
Ставшие при этом пустыми закладки делаются недоступными для перехода и затеняются.
При вызове скрипта из меню дисков активной считается та панель, для которой вызвано меню дисков, а пассивной - противоположная. 
Закладка - это последовательность символов (букв и цифр), которой сопоставлена папка(файл) или несколько папок(файлов).
Данное меню позволяет манипулировать всеми закладками в интерактивном режиме.
Также оно может быть вызвано при частичном совпадении набранного имени с имеющейся закладкой или переменной окружения.

^#Быстрые клавиши#

  #F1#         - |Эта справка.
  #Esc#        - |Выход.
  #Enter#      - |Выполнить действие по умолчанию.
  #CtrlPgDn#   - |Перейти по закладке/переменной окружения.
  #ShiftEnter# - |Выполнить команду "открыть" из системного контекстного меню.
  #ShiftF4#    - |Выполнить команду "редактировать" из системного контекстного меню.
  #Закладка#   - |Позиционироваться на указанную закладку в окне. Работает с прижатым #RCtrl#, аналогично #Alt#-комбинациям в панелях Far-а,
либо без него. Набираемая последовательность отображается слева вверху на рамке главного меню. При набранной последовательности клавиши
#Up#, #Down#, #Home#, #End# перемещают по подходящим закладкам. #Esc# завершает обработку последовательности.
Остальные горячие клавиши главного меню также прерывают её и выполняют свою основную функцию.

  #F4#         - |~Редактировать закладку~@edit@.
  #F5#         - |~Копировать закладку~@edit@.
  #Ins#        - |~Новая закладка~@edit@.
  #Del#        - |Удалить закладку.

  #F9#         - |~Настройка параметров скрипта~@config@.

@=

 ~Содержание~@contents@

@keys
$^Работа в панели Far

^#Описание#

   В интерактивном режиме можно выполнить действие по умолчанию для существующей закладки/переменной окружения, или создать новую закладку.
Имена закладок набираются как последовательность клавиш при нажатом #RCtrl# или #RCtrl# совместно с #Shift#/#RAlt#.
Допустимые для имён закладок символы указаны в ~справке по редактированию закладок~@edit@. Недопустимы непечатные клавиши, #Tab# и #Пробел#.
Кириллица запоминается как латиница, строчные буквы как прописные, не буквенные знаки - как символ с не прижатым #Shift#.
В процессе набора в окне Far выводится ~настраиваемая~@config@ подсказка набранных символов.

^#Быстрые клавиши#

  #CtrlЗакладка#      - |Перейти по указанной закладке или переменной окружения.
В зависимости от ~формата значения закладки~@edit@ выполняет действие по умолчанию для активной, пассивной или обоих панелей Far-а.
Если набранная последовательность частично совпадает с имеющейся, то выводится ~меню~@main@ для выбора нужной.
  #CtrlShiftЗакладка# - |Запомнить текущую папку активной панели Far-а в локальном или глобальном профиле Far-а (в зависимости от ~настроек~@config@).
Если такая закладка уже есть, выдаётся запрос на подтверждение переназначения закладки на новую папку.
  #CtrlAltЗакладка#   - |Запомнить текущие папки обеих панелей Far-а в локальном или глобальном профиле Far-а (в зависимости от ~настроек~@config@).
Если такая закладка уже есть, выдаётся запрос на подтверждение переназначения закладки на новую пару папок.

@=

 ~Содержание~@contents@

@prefix
$^Командная строка

^#Описание#

   В командной строке можно вводить команды, начинающиеся с одного из префиксов.
   Формат команды: |использовать действие по умолчанию для закладки/переменной окружения:
#префикс#:[#последовательность#[#дополнение, начинающееся с '\'#]];
                   |вызвать справку: #префикс#:;
                   |для остальных вариантов: #префикс#:[#последовательность# [#значение#]].
   #Последовательность# преобразуется, как указано в ~справке по редактированию закладок~@edit@.

^#Обрабатываемые префиксы#

^Переход по закладке

  #bm#     - |Выполнить действие по умолчанию для закладки/переменной окружения.
Если #последовательность# частично совпадает с имеющейся, то выводится ~меню~@main@ для выбора нужной.
Если #последовательность# отсутствует, то выводится полное ~меню~@main@.
Поскольку имена закладок переводятся в символы, набираемые при нажатом Ctrl, то, к примеру, команда #bm:Фильмы# равнозначна #bm:ABKMVS#.
Если указано #дополнение#, то оно добавляется справа к значению закладки.
К примеру, для закладки #ABKMVS# можно указать #bm:фильмы\Мультфильмы\Фиксики#.
Для #дополнения# действуют те же правила интерпретации, что и для ~значения закладки~@edit@.

^Создание новой закладки

  #Значение# указывать необходимо.
Если закладка с таким именем в указанном профиле уже существует, выдаётся запрос на перезапись.

  #bma#    - |Добавить закладку. Профиль хранения выбирается в зависимости от ~настроек~@config@.
  #bmal#   - |Добавить локальную закладку.
  #bmag#   - |Добавить глобальную закладку.

^Изменение существующей или создание новой закладки в диалоговом режиме

   Если закладка с таким именем в указанном профиле не существует, создаётся в диалоговом режиме новая.
В качестве начального значения используется #значение# (если указано) или значение существующей закладки/пустая строка (для новой).

  #bme#    - |Редактировать в диалоге закладку.
Если с таким именем существуют и локальная, и глобальная закладки, редактируемая выбирается в зависимости от ~настроек~@config@.
  #bmel#   - |Редактировать в диалоге локальную закладку.
  #bmeg#   - |Редактировать в диалоге глобальную закладку.

^Удаление закладки

   #Значение# игнорируется.

  #bmr#    - |Удалить закладку.
Если с таким именем существуют и локальная, и глобальная закладки, удаляемая выбирается в зависимости от ~настроек~@config@.
  #bmrl#   - |Удалить локальную закладку.
  #bmrg#   - |Удалить глобальную закладку.

^Справка

  #bmhelp# - |Вызов справки по скрипту.

@=

 ~Содержание~@contents@

@edit
$^Создание/изменение/копирование закладки в диалоге

^#Описание#

  Здесь можно изменить закладку, удалить (просто удалив значение), сменить имя и расположение закладки.
В последнем случае закладка копируется или переносится, в зависимости от выбранной операции.

^#Формат закладки#

  Имя закладки может состоять из следующих символов: #',-./0123456789;=ABCDEFGHIJKLMNOPQRSTUVWXYZ[]`#.
Недопустимый символ, набранный на одной клавише с допустимым, переводится в соответствующий допустимый или игнорируется.
Например, набранная на русской раскладке закладка #"Хлам"# будет преобразована в #'[KFV'#.

  Содержимое закладки может быть в старом или новом формате.

  Старый формат закладки: |[<[#Модификатор#]>][#Значение для активной панели#][<[#Модификатор#]>#Значение для пассивной панели#].
#Значение для активной панели# меняет только активную панель. #Значение для пассивной панели# меняет только пассивную панель.
  Новый формат закладки:  |<#Признак#[#Модификатор#]>#Значение#[<#Признак#[#Модификатор#]>#Значение#[...]].

  Признак указывает, для какой панели действует значение. Модификатор корректирует действие со значением.
Значение может содержать полное имя существующей папки или файла, либо маску (включая маску имени локального диска).
Кроме того, в зависимости от ~настроек~@config@, часть полного имени, не соответствующая реальному элементу, может интерпретироваться как маска.
Если маске соответствует несколько элементов, выводится меню для выбора единственного.
При этом можно также выбрать действие с элементом, аналогично ~меню закладок~@main@.
Если значения является папкой, она открывается в панели.
Если значение является файлом, то содержащая его папка открывается в панели, а сам файл делается текущим.
Значение может содержать переменные окружения.

  Имеются четыре признака:  #A# - |активная панель;
                            #P# - |пассивная панель;
                            #L# - |левая панель;
                            #R# - |правая панель.

  Имеется три модификатора: #C# - |после установки папок на панелях сделать эту панель активной.
                            #X# - |не менять панели, а открыть элемент средствами ОС.
                            #E# - |не менять панели, а редактировать элемент средствами ОС.

  В случае, если на одну панель указывают несколько папок или несколько признаков сопровождаются модификатором, действует последний вариант.

  Полный формат папки, для любых закладок:
    [#Плагин#]||[#Файл-контейнер#]|[#Путь внутри плагина/файла-контейнера#]|[#Параметр#], допустимо
    [#Плагин#]||[#Путь внутри плагина#]|[#Параметр#] или
    [#Плагин#]||[#Файл-контейнер#]|[#Путь внутри плагина/файла-контейнера#] или
    [#Плагин#]||[#Путь внутри плагина#] или
    #Путь#,
  где #Путь# - путь к файлу или папке.

^#Быстрые клавиши#

  #Esc#   - |Выход без сохранения.
  #Enter# - |Сохранить закладку в базе и выйти.
  #F1#    - |Эта справка.

  #AltR#  - |Перейти к имени закладки.
  #AltF#  - |Перейти к содержимому закладки.
  #AltL#  - |Локальная закладка.
  #AltK#  - |Глобальная закладка.

@=

 ~Содержание~@contents@

@config
$^Настройка

^#Описание#

  Данный диалог позволяет включать и выключать поддержку локальных и глобальных закладок и переменных окружения независимо друг от друга,
а также настраивать режимы работы скрипта. Внесённые изменения могут быть отброшены или приняты, временно или насовсем.

^#Быстрые клавиши#

  #Esc#        - |Выход без сохранения.
  #Enter#      - |Сохранить настройки в базе и выйти.
  #ShiftEnter# - |Применить настройки временно и выйти.
  #F1#         - |Эта справка.


^#Параметры настройки#

  #Использовать локальные закладки#          - |Использовать закладки, сохранённые в локальном профиле Far-а. Обычно там хранится
машинозависимая информация.
  #Использовать глобальные закладки#         - |Использовать закладки, сохранённые в глобального профиле Far-а. Обычно там хранится
машинонезависимая информация.
  #Использовать закладки#                    - |Пункт используется вместо предыдущих двух, если данные локального и глобального профилей Far-а
хранятся в одном месте.
  #Использовать переменные окружения#        - |Использовать для перехода переменные окружения, значения которых указывают на существующие пути.
  #Показывать переменные окружения в меню#   - |Позволяет использовать переменные окружения как закладки, но не показывает их в ~меню закладок~@main@.
  #Расширенная маска#                        - |Если часть полного имени, не соответствует реальному элементу,
производится попытка интерпретировать его как маску, заключив в #*#.
  #Выбрать цвет подсказки#                   - |Вызывает диалог настройки цвета подсказки при ~интерактивном наборе~@keys@.
Если был выбран цвет "чёрный на чёрном", подсказка не выводится.
  #Строка подсказки#                         - |Определяет, в какой строке выводится подсказка при ~интерактивном наборе~@keys@.
Отрицательные номера строки отсчитываются снизу (-1 - самая нижняя), неотрицательные - сверху (0 - самая верхняя).
  #Длительность вывода подсказки перехода#   - |В течение этого времени после перехода по закладке будет выводиться соответствующее сообщение.
  #Длительность вывода подсказки сохранения# - |В течение этого времени после сохранения новой закладки будет выводиться соответствующее сообщение.
Допустимые значения:
                                             #<0# - |сообщения не будет;
                                              #0# - |сообщение будет выводиться до нажатия любой клавиши;
                                             #>0# - |сообщение будет выводиться указанное число миллисекунд или до нажатия любой клавиши.

  #Сохранить#                                - |Сохранить настройки в базе и выйти.
  #Применить до выхода#                      - |Применить настройки временно и выйти.
  #Отмена#                                   - |Выход без сохранения.

@=

 ~Содержание~@contents@

@function
$^Использование скрипта как функции

  Скрипт может вызываться как функция, имеющая два параметра.
Первым параметром указывается ~префикс~@prefix@, вторым - соответствующая данному префиксу командная строка.

^#Пример#

  local BM = loadfile((...):match("^(.*\\)[^\\]*$").."BookmarkManager.lua") -- файл должен лежать рядом с BookmarkManager.lua
  if not BM then
    far.Message("Не найден BookmarkManager","Мой макрос для вызова BookmarkManager",";Ok","w")
  else
    Macro{
      area="Shell Info QView Tree";
      key="LCtrl/";
      description="BookmarkManager - переход в диалоге";
      action=function()
        local cmd=far.InputBox(nil,'BookmarkManager: переход на закладку','Введите закладку[\\<дополнение>]','BookmarkManagerAddonCommand',
                               nil,nil,nil,{FIB_ENABLEEMPTY=1, FIB_BUTTONS=1})
        if cmd then BM('bm',cmd) end
      end
    }
  end

@=

 ~Содержание~@contents@

@list
$^Список макросов скрипта
  #Клавиша#               |#Скрипт#

  #RCtrl/#              - |~Главное окно менеджера закладок~@main@.
  #RCtrlЗакладка#       - |~Переход по закладке~@keys@
  #RCtrlShiftЗакладка#  - |~Сохранить папку активной панели в закладке~@keys@
  #RCtrlAltЗакладка#    - |~Сохранить папки активной и пассивной панелей в закладке~@keys@

@=

 ~Содержание~@contents@

@about
$^О скрипте

 Автор:        #IgorZ#

 Версия:       #3.0.1#

 Адрес в сети: ~http://forum.farmanager.com/viewtopic.php?t=8465~@http://forum.farmanager.com/viewtopic.php?t=8465@
@=‗
  Основан на идее Max Rusov.

  Данный скрипт предназначен для назначения закладок на папки или файлы и перехода по ним, по существующим путям из переменных окружения,
а также запускать их средствами ОС.
Может использоваться как ~макрос~@list@, ~из командной строки~@prefix@, вызываться из меню дисков и плагинов Far,
а также вызываться ~программно~@function@.

@=

 ~Содержание~@contents@

@contents
$^Содержание

  ~Главное окно~@main@
  ~Работа в панели~@keys@
  ~Командная строка~@prefix@
  ~Создание/изменение/копирование закладки в диалоге~@edit@
  ~Настройка параметров~@config@
  ~Программное использование~@function@
  ~Список макросов скрипта~@list@

  ~О скрипте~@about@
